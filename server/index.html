<!DOCTYPE html>
<html>
<title>Morphee control</title>
<head>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="/static/mdl/1.3.0/material.min.css">
  <script defer src="/static/mdl/1.3.0/material.min.js"></script>
  <script src="/static/jquery/3.6.0/jquery-3.6.0.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>

  </style>
</head>
<body>
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
  <header class="mdl-layout__header">
    <div class="mdl-layout__header-row">
        <!-- Title -->
        <span class="mdl-layout-title">Morphee</span>
        <!-- Add spacer, to align navigation to the right -->
        <div class="mdl-layout-spacer"></div>
        <!-- Navigation -->
      </div>
    </header>
    <div class="mdl-layout__drawer">
      <span class="mdl-layout-title">Morphee</span>
      <nav class="mdl-navigation">
        <a class="mdl-navigation__link" href="#0" id="btn-create-card">Encoder une carte</a>
      </nav>
    </div>
    <main class="mdl-layout__content">
      
      <div style="" id="panel-create-card">

        <div class="mdl-grid">
          <div class="mdl-cell mdl-cell--1-col">
            <div class="demo-card-wide mdl-card mdl-shadow--2dp">
              <div class="mdl-card__title">
                <h2 class="mdl-card__title-text">Encoder une carte</h2>
              </div>
              <form action="#">
              <div class="mdl-card__supporting-text">
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="style-zen" style="display:block;">
                  <input type="radio" id="style-zen" class="mdl-radio__button" name="btn-style" value="zen">
                  <span class="mdl-radio__label">Zen</span>
                </label>
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="style-elements" style="display:block;">
                  <input type="radio" id="style-elements" class="mdl-radio__button" name="btn-style" value="elements">
                  <span class="mdl-radio__label">Elements</span>
                </label>
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="style-musique" style="display:block;">
                  <input type="radio" id="style-musique" class="mdl-radio__button" name="btn-style" value="musique">
                  <span class="mdl-radio__label">Musique</span>
                </label>
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="style-relaxation" style="display:block;">
                  <input type="radio" id="style-relaxation" class="mdl-radio__button" name="btn-style" value="relaxation">
                  <span class="mdl-radio__label">Relaxation</span>
                </label>
              </div>
              <div class="mdl-card__supporting-text">
                <div class="mdl-textfield mdl-js-textfield">
                  <input class="mdl-textfield__input" type="text" id="modipy-url">
                  <label class="mdl-textfield__label" for="modipy-url">Modipy url...</label>
                </div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored" id="btn-encode-card">
                  Encode
                </button>
              </div>
              </form>
              <div class="mdl-card__supporting-text">
                  <div id="progress-encode" class="mdl-progress mdl-js-progress mdl-progress__indeterminate" style="display:none"></div>
              </div>
              <div class="mdl-card__menu">
              </div>
            </div>
          </div>
        </div>
      </div>

      <dialog class="mdl-dialog">
        <h4 class="mdl-dialog__title">Allow data collection?</h4>
        <div class="mdl-dialog__content">
          <p>
            Allowing us to collect data will let us get you the information you want faster.
          </p>
        </div>
        <div class="mdl-dialog__actions">
          <button type="button" class="mdl-button close">Close</button>
        </div>
      </dialog>

    </main>
  </div>

  <script src="/static/socket.io/4.0.0/socket.io.js"></script>
  <script>
    const zeroPad = (num, places) => String(num).padStart(places, '0')

    var socket = io.connect(); //load socket.io-client and connect to the host

    function checkRemaining() {
      socket.emit("check_remaining", 0);
      setTimeout(function(){ 
          checkRemaining();
        }, 
        1000
      );
    }

    function minuteToHHMM(minutes) {
      var hours = (minutes / 60);
      var rhours = Math.floor(hours);
      var minutes = (hours - rhours) * 60;
      var rminutes = Math.round(minutes);
      return zeroPad(rhours, 2) + ':' + zeroPad(rminutes, 2);
    }

    $( document ).ready(function() {

      var dialog = document.querySelector('dialog');
      if (! dialog.showModal) {
        dialogPolyfill.registerDialog(dialog);
      }
      dialog.querySelector('.close').addEventListener('click', function() {
        dialog.close();
      });

      $("#btn-encode-card").on("click", function(event) {
        event.preventDefault();
        var modipyUrl = $("#modipy-url").val();
        var modipyStyle = $('input[type=radio][name=btn-style]:checked').val();
        socket.emit("encode_card", modipyUrl, modipyStyle);
      });
      socket.on("encode_ack", (data) => {
        if (data.ack) {
            $("#btn-encode-card").hide();
            $('#progress-encode').show();
        } else {
            $('.mdl-dialog .mdl-dialog__title').text(data.title);
            $('.mdl-dialog .mdl-dialog__content p').text(data.message);
            dialog.showModal();
        }
      });

      socket.on("encoded_ack", (data) => {
        $("#btn-encode-card").show();
        $('#progress-encode').hide();
      });


/*
      socket.on("update_remaining", (data) => {
        $('#panel-remainging').text(minuteToHHMM(data.remainingSeconds/60))
      });

      socket.emit("get_snooze", 0);
      socket.on("update_snooze", (data) => {
        $('#panel-snooze-current').attr("data-minutes", data.snooze);
        $("#panel-snooze-current").text(minuteToHHMM(data.snooze));
      });

      $("#btn-remove-snooze").on("click", function(event) {
        var currentSnooze = $("#panel-snooze-current").data('minutes');

        currentSnooze = currentSnooze - 15;
        if (currentSnooze<0)
          currentSnooze = 0;

        $('#panel-snooze-current').attr("data-minutes", currentSnooze);
        $("#panel-snooze-current").text(minuteToHHMM(currentSnooze));
      });
      $("#btn-add-snooze").on("click", function(event) {
        var currentSnooze = $("#panel-snooze-current").data('minutes');

        currentSnooze = currentSnooze + 15;
        if (currentSnooze>1440)
          currentSnooze = 1440;

        $('#panel-snooze-current').attr("data-minutes", currentSnooze);
        $("#panel-snooze-current").text(minuteToHHMM(currentSnooze));
      });

      $("#btn-launch-snooze").on("click", function(event) {
        event.preventDefault();
        var currentSnooze = $("#panel-snooze-current").data('minutes');
        socket.emit("launch_snooze", currentSnooze);
      });
      $("#btn-stop-snooze").on("click", function(event) {
        event.preventDefault();
        socket.emit("stop_snooze", 0);
      });

      $("#btn-snooze").on("click", function(event) {
        event.preventDefault();
        $('#panel-snooze').show();
        $('#panel-settings').hide();
        document.querySelector('.mdl-layout').MaterialLayout.toggleDrawer();
      });

      $('#btn-settings').on('click', function(event) {
        event.preventDefault();
        $('#panel-settings').show();
        $('#panel-snooze').hide();
        document.querySelector('.mdl-layout').MaterialLayout.toggleDrawer();
      });

      socket.emit("get_rain");
      socket.on("update_rain", (data) => {
        document.getElementById('rain-' + data.rain).parentNode.MaterialRadio.check();
      });
      $('input[type=radio][name=btn-rain]').change(function() {
          socket.emit("set_rain", this.value);
      });

      socket.emit("get_thunder");
      socket.on("update_thunder", (data) => {
        document.getElementById('thunder-' + data.thunder).parentNode.MaterialRadio.check();
      });
      $('input[type=radio][name=btn-thunder]').change(function() {
          socket.emit("set_thunder", this.value);
      });

      socket.emit("get_light");
      socket.on("update_light", (data) => {
        if (data.light==1)
          $('#switch-light')[0].MaterialSwitch.on();
        else
          $('#switch-light')[0].MaterialSwitch.off();
      });
      $('#btn-light').change(function(){
        if($(this).is(':checked'))
          socket.emit("set_light", 1);
        else
          socket.emit("set_light", 0);
      });

      socket.emit("get_volume");
      socket.on("update_volume", (data) => {
        $('#panel-volume-current').attr("data-volume", data.volume);
        $("#panel-volume-current").text(data.volume);
      });
      $("#btn-remove-volume").on("click", function(event) {
        var volume = $("#panel-volume-current").data('volume');

        volume = volume - 1;
        if (volume<0)
          volume = 0;

        $('#panel-volume-current').attr("data-volume", volume);
        $("#panel-volume-current").text(volume);
        socket.emit("set_volume", volume);
      });
      $("#btn-add-volume").on("click", function(event) {
        var volume = $("#panel-volume-current").data('volume');

        volume = volume + 1;
        if (volume>100)
          volume = 100;

        $('#panel-volume-current').attr("data-volume", volume);
        $("#panel-volume-current").text(volume);
        socket.emit("set_volume", volume);
      });

      checkRemaining();
*/
    });
      
  </script>
</html>
</body>

</html>